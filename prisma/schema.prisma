// This is your Prisma schema file,
// learn more about it in the docs https//pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Nft2 {
  id           String  @id
  block        Int
  collection   String
  symbol       String
  transferable Int
  sn           String
  metadata     String?
  forsale      BigInt
  reactions    Json
  changes      Json
  owner        String
  rootowner    String
  burned       String
  equipped     String?
  priority     Json
  children     Json
  resources    Json
  properties   Json?
  pending      Boolean

  @@index([block])
  @@index([collection])
  @@map("nft2")
}

model Collection2 {
  id       String @id
  block    Int
  max      Int
  issuer   String
  symbol   String
  metadata String
  changes  Json
  count    Int

  @@index([issuer])
  @@index([symbol])
  @@map("collection2")
}

model Base2 {
  id       String  @id
  block    Int
  symbol   String
  issuer   String
  type     String?
  parts    Json?
  changes  Json
  themes   Json?
  metadata String?

  @@map("base2")
}

model History2 {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now()) @map("created_at")
  schemaName String   @map("schema_name")
  tableName  String   @map("table_name")
  operation  String
  user       String   @default(dbgenerated("current_user"))
  newValue   Json?    @map("new_value")
  oldValue   Json?    @map("old_value")

  @@index([createdAt])
  @@map("history2")
}

model ConsolidationInfo {
  version          String                        @id
  latestBlock      Int                           @map("latest_block")
  latestRmrkOffset Int                           @map("latest_rmrk_offset")
  status           LatestConsolidatingRmrkStatus

  @@map("consolidation_info")
}

model ConsolidationLock {
  version   String   @id
  createdAt DateTime @default(now()) @map("created_at")
  user      String
  key       String   @default(uuid())

  @@map("consolidation_lock")
}

// TODO: Implement history triggers
model Custodian {
  custodian    String @id
  block        Int
  proposalFee  String // u128
  voteFee      String // u128
  recertifyFee String // u128
  maxOptions   Int
  changes      Json

  @@index([block])
}

model Proposal {
  id               String  @id
  block            Int
  custodian        String
  name             String
  description      String
  collections      Json // string[]
  options          Json // string[]
  passingThreshold Float?
  startDate        Float
  snapshot         Float
  endDate          Float
  nftWeight        Boolean
  electorate       Boolean
}

enum LatestConsolidatingRmrkStatus {
  processing
  complete

  @@map("latest_consolidating_rmrk_status")
}
